# cvd19_rtprediction

COVID-19 の再生産数 (Rt) を、SIR モデルと MCMC を用いて推定するためのプロジェクトです。主に東京都の公開データを対象に、Stan と R を組み合わせて解析を実行します。

## リポジトリ構成

| ファイル / ディレクトリ | 役割 |
| --- | --- |
| `corona.Rmd` | 解析のエントリーポイントとなる R Markdown。データ取得から可視化、Stan による推定までを一通り実行します。 |
| `SIR.stan` | Stan で記述した SIR モデル。曜日効果 (`beta_wd`) を含むベータ値や、感染者・回復者の潜在状態を同時に推定します。 |
| `README.md` | 本ドキュメント。新規参加者向けのガイドラインや、プロジェクトの背景をまとめています。 |

## 解析フローの概要

1. **データ取得**: `corona.Rmd` が東京都の COVID-19 公開データ (CSV) をダウンロードし、日次集計や欠損補完を行います。
2. **特徴量計算**: 集計データから感染率 (`beta`) や回復率 (`gamma`)、曜日情報 (`Wd`) など Stan モデルに必要な変数を生成します。
3. **Stan モデルによる推定**: `SIR.stan` を用いて、潜在状態 (感染者・回復者数) と Rt (`R_param`) を MCMC で推定します。曜日ごとの調整項を導入することで、報告遅延などの影響を吸収します。
4. **可視化・結果検証**: 推定結果を `ggplot2` や `plotly` で可視化し、Rt のトレンドや感染・回復曲線を確認します。

## 新規参加者が押さえておきたいポイント

* **使用言語・ツール**: R (tidyverse, lubridate, plotly, rstan など) と Stan。`rstan` の並列化設定や `control` オプションは `corona.Rmd` で定義されています。
* **Stan モデルの構造**: 観測値 (`I_obs`, `R_obs`) をポアソン分布でモデル化し、状態空間モデルとして感染者・回復者を推定しています。`R_lag` により回復までの遅延を表現し、`beta_wd` が曜日効果を担います。
* **人口サイズ (`S0`)**: 対象地域の人口を固定値として使用します。`corona.Rmd` 内でコメントアウトされた候補が複数あり、対象地域に応じて切り替えます。
* **可視化の想定環境**: 日本語フォント (例: `HiraKakuProN-W3`) を指定しているため、環境に応じたフォント設定が必要な場合があります。

## 次に学ぶと良いトピック

1. **Stan と状態空間モデル**: `SIR.stan` の各ブロック (data / parameters / transformed parameters / model) と、それぞれが解析フローにどう関係するかを理解すると、モデル改良が容易になります。
2. **R Markdown のワークフロー**: データ取得・加工・可視化・モデル実行を一つの Rmd で管理しているため、チャンクの分割やキャッシュ設定などのベストプラクティスを学ぶと再現性が向上します。
3. **疫学指標の解釈**: Rt、`beta`, `gamma` などの疫学的指標の意味を整理しておくと、結果の解釈やレポーティングに役立ちます。
4. **データソースの更新**: 公開データの URL や項目名が変わる可能性があるため、`read.csv` 部分の保守方法や、代替データセットの探索方法も把握しておくと安心です。

## 参考リンク

* [Stan ドキュメント](https://mc-stan.org/users/documentation/)
* [COVID-19 東京都オープンデータ](https://catalog.data.metro.tokyo.lg.jp/)

新しい参加者は、まず `corona.Rmd` を上から順に実行してワークフロー全体の流れを把握し、続いて `SIR.stan` のモデル構造を読み解くことをおすすめします。
